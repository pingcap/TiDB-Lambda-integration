# aws-lambda-cloudformation Code Example

This repository contains an AWS Lambda function that uses TiDB Cloud as the database, Sequelize as the ORM, Fastify as the API framework, and AWS Secrets Manager SDK to retrieve connection configurations.

## Technologies

- TiDB Cloud: A cloud-native MySQL-compatible HTAP database.
- Sequelize: A promise-based Node.js ORM for working with relational databases such as MySQL, MariaDB, and PostgreSQL.
- Fastify: A web framework for building fast and scalable APIs with Node.js.
- AWS Secrets Manager SDK: A library for accessing and managing secrets in AWS Secrets Manager.

## Installation

1. Install Node.js 18.x and yarn on your machine.
2. Clone this repository and navigate to the project directory `/aws-lambda-cloudformation`.
3. Run `yarn install` to install the dependencies.

## Usage

1. Create a TiDB Cloud cluster and retrieve the connection details.
2. Store the connection details(`TiDBDatabase`, `TiDBUser`, `TiDBPassword`, `TiDBHost` and `TiDBPort` which are the database-related details of your TiDB Cloud cluster) as a secret named `autogenerated/cloudformation/tidbcloud` in AWS Secrets Manager.
3. Run `yarn start` to start the server.

> Note: AWS Secrets Manager SDK will automatically retrieve the secret value from AWS Secrets Manager and use it to connect to TiDB Cloud.
> You need to have the permission to access the secret.
> You need to configure the AWS credentials on your machine to access AWS Secrets Manager.
> See [AWS Secrets Manager SDK](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/SecretsManager.html) for more details.

## Build

Run `yarn build` to build the project.

ESBuild will bundle the project into a single file `dist/index.js`.

It will also zip the file into `dist/index.zip` which is the deployment package for AWS Lambda.

## Known Issues

There are no known issues at this time.

## Contribution Guidelines

If you would like to contribute to this project, please follow these guidelines:

1. Fork the repository.
2. Create a new branch for your changes.
3. Make your changes and commit them to your branch.
4. Open a pull request to merge your changes into the master branch.

## Acknowledgments

- [TiDB Cloud](https://pingcap.com/products/tidbcloud/)
- [Sequelize](https://sequelize.org/): A promise-based Node.js ORM for working with relational databases.
- [Fastify](https://www.fastify.io/): A web framework for building fast and scalable APIs with Node.js.
- [AWS Secrets Manager SDK](https://aws.amazon.com/secrets-manager/): A library for accessing and managing secrets in AWS Secrets Manager.
